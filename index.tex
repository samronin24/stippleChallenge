% Options for packages loaded elsewhere
% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
  letterpaper,
  DIV=11,
  numbers=noendperiod]{scrartcl}
\usepackage{xcolor}
\usepackage{amsmath,amssymb}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
% Make \paragraph and \subparagraph free-standing
\makeatletter
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}{
    \@ifstar
      \xxxParagraphStar
      \xxxParagraphNoStar
  }
  \newcommand{\xxxParagraphStar}[1]{\oldparagraph*{#1}\mbox{}}
  \newcommand{\xxxParagraphNoStar}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}{
    \@ifstar
      \xxxSubParagraphStar
      \xxxSubParagraphNoStar
  }
  \newcommand{\xxxSubParagraphStar}[1]{\oldsubparagraph*{#1}\mbox{}}
  \newcommand{\xxxSubParagraphNoStar}[1]{\oldsubparagraph{#1}\mbox{}}
\fi
\makeatother

\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{241,243,245}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.40,0.45,0.13}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\ExtensionTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.28,0.35,0.67}{#1}}
\newcommand{\ImportTok}[1]{\textcolor[rgb]{0.00,0.46,0.62}{#1}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.07,0.07,0.07}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}

\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\newsavebox\pandoc@box
\newcommand*\pandocbounded[1]{% scales image to fit in text height/width
  \sbox\pandoc@box{#1}%
  \Gscale@div\@tempa{\textheight}{\dimexpr\ht\pandoc@box+\dp\pandoc@box\relax}%
  \Gscale@div\@tempb{\linewidth}{\wd\pandoc@box}%
  \ifdim\@tempb\p@<\@tempa\p@\let\@tempa\@tempb\fi% select the smaller of both
  \ifdim\@tempa\p@<\p@\scalebox{\@tempa}{\usebox\pandoc@box}%
  \else\usebox{\pandoc@box}%
  \fi%
}
% Set default figure placement to htbp
\def\fps@figure{htbp}
\makeatother





\setlength{\emergencystretch}{3em} % prevent overfull lines

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}



 


\KOMAoption{captions}{tableheading}
\makeatletter
\@ifpackageloaded{tcolorbox}{}{\usepackage[skins,breakable]{tcolorbox}}
\@ifpackageloaded{fontawesome5}{}{\usepackage{fontawesome5}}
\definecolor{quarto-callout-color}{HTML}{909090}
\definecolor{quarto-callout-note-color}{HTML}{0758E5}
\definecolor{quarto-callout-important-color}{HTML}{CC1914}
\definecolor{quarto-callout-warning-color}{HTML}{EB9113}
\definecolor{quarto-callout-tip-color}{HTML}{00A047}
\definecolor{quarto-callout-caution-color}{HTML}{FC5300}
\definecolor{quarto-callout-color-frame}{HTML}{acacac}
\definecolor{quarto-callout-note-color-frame}{HTML}{4582ec}
\definecolor{quarto-callout-important-color-frame}{HTML}{d9534f}
\definecolor{quarto-callout-warning-color-frame}{HTML}{f0ad4e}
\definecolor{quarto-callout-tip-color-frame}{HTML}{02b875}
\definecolor{quarto-callout-caution-color-frame}{HTML}{fd7e14}
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Table of contents}
\else
  \newcommand\contentsname{Table of contents}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{List of Figures}
\else
  \newcommand\listfigurename{List of Figures}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{List of Tables}
\else
  \newcommand\listtablename{List of Tables}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Figure}
\else
  \newcommand\figurename{Figure}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Table}
\else
  \newcommand\tablename{Table}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother
\usepackage{bookmark}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={Selection Bias \& Missing Data Challenge - Part 1},
  colorlinks=true,
  linkcolor={blue},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}


\title{Selection Bias \& Missing Data Challenge - Part 1}
\usepackage{etoolbox}
\makeatletter
\providecommand{\subtitle}[1]{% add subtitle to \maketitle
  \apptocmd{\@title}{\par {\large #1 \par}}{}{}
}
\makeatother
\subtitle{Blue Noise Stippling: Creating Art from Data}
\author{}
\date{}
\begin{document}
\maketitle


\section{ðŸŽ¨ Selection Bias \& Missing Data Challenge - Part
1}\label{selection-bias-missing-data-challenge---part-1}

\begin{tcolorbox}[enhanced jigsaw, breakable, leftrule=.75mm, arc=.35mm, rightrule=.15mm, toprule=.15mm, toptitle=1mm, bottomrule=.15mm, opacityback=0, colbacktitle=quarto-callout-important-color!10!white, titlerule=0mm, opacitybacktitle=0.6, colback=white, colframe=quarto-callout-important-color-frame, coltitle=black, title=\textcolor{quarto-callout-important-color}{\faExclamation}\hspace{0.5em}{ðŸ“Š Challenge Requirements}, bottomtitle=1mm, left=2mm]

\textbf{Your Task:} Reproduce the blue noise stippling process
demonstrated below to create: 1. A stippled version of your chosen image
2. A progressive stippling GIF animation 3. Post both to a GitHub Pages
site with appropriate captions and a brief explanation

\textbf{Part 2 Preview:} On November 18th, we'll tackle Part 2 of this
challenge, where you'll create a statistical meme about selection bias
and missing data using your stippled images.

\end{tcolorbox}

\subsection{The Problem: Can Algorithms Create
Art?}\label{the-problem-can-algorithms-create-art}

\textbf{Core Question:} How can we convert a photograph into an
aesthetically pleasing pattern of dots that preserves the visual
information of the original image?

\textbf{The Challenge:} Blue noise stippling is a technique that
converts images into patterns of dots (stipples) using algorithms that
balance visual accuracy with spatial distribution. This challenge asks
you to implement a modified ``void and cluster'' algorithm that combines
importance sampling with blue noise distribution properties to create
stippling patterns that are both visually accurate and spatially
well-distributed.

\textbf{Our Approach:} We'll use a modified void-and-cluster algorithm
that: 1. Creates an importance map identifying visually important
regions 2. Uses a toroidal (periodic) Gaussian kernel for repulsion to
ensure blue noise properties 3. Iteratively selects points with minimum
energy 4. Balances image content importance with blue noise spatial
distribution

\subsection{Introduction to Blue Noise
Stippling}\label{introduction-to-blue-noise-stippling}

Blue noise stippling is a technique for converting images into a pattern
of dots (stipples) that preserves the visual information of the original
image while creating an aesthetically pleasing, evenly distributed
pattern. This method follows the approach described by
\href{https://bartwronski.com/2022/08/31/progressive-image-stippling-and-greedy-blue-noise-importance-sampling/}{Bart
Wronski}.

The method uses a modified ``void and cluster'' algorithm that combines
importance sampling with blue noise distribution properties to create
stippling patterns that are both visually accurate and spatially
well-distributed. This version uses \textbf{smooth extreme
downweighting} that selectively downweights very dark and very light
tones while preserving mid-tones, creating a more balanced distribution
of stipples across the image.

\subsection{Loading the Original
Image}\label{loading-the-original-image}

First, let's load an image that we'll convert to a blue noise stippling
pattern. You can use any image you'd like, but we'll demonstrate with
the provided example.

\subsubsection{Python}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ numpy }\ImportTok{as}\NormalTok{ np}
\ImportTok{from}\NormalTok{ PIL }\ImportTok{import}\NormalTok{ Image}
\ImportTok{import}\NormalTok{ matplotlib.pyplot }\ImportTok{as}\NormalTok{ plt}

\CommentTok{\# Load the image}
\NormalTok{img\_path }\OperatorTok{=} \StringTok{\textquotesingle{}sam\_headshot.jpg\textquotesingle{}}
\NormalTok{original\_img }\OperatorTok{=}\NormalTok{ Image.}\BuiltInTok{open}\NormalTok{(img\_path)}

\CommentTok{\# Convert to grayscale if needed}
\ControlFlowTok{if}\NormalTok{ original\_img.mode }\OperatorTok{!=} \StringTok{\textquotesingle{}L\textquotesingle{}}\NormalTok{:}
\NormalTok{    original\_img }\OperatorTok{=}\NormalTok{ original\_img.convert(}\StringTok{\textquotesingle{}L\textquotesingle{}}\NormalTok{)}

\CommentTok{\# Convert to numpy array and normalize to [0, 1]}
\NormalTok{img\_array }\OperatorTok{=}\NormalTok{ np.array(original\_img, dtype}\OperatorTok{=}\NormalTok{np.float32) }\OperatorTok{/} \FloatTok{255.0}

\CommentTok{\# Display the original image}
\NormalTok{fig, ax }\OperatorTok{=}\NormalTok{ plt.subplots(figsize}\OperatorTok{=}\NormalTok{(}\FloatTok{6.5}\NormalTok{, }\DecValTok{5}\NormalTok{))}
\NormalTok{ax.imshow(img\_array, cmap}\OperatorTok{=}\StringTok{\textquotesingle{}gray\textquotesingle{}}\NormalTok{, vmin}\OperatorTok{=}\DecValTok{0}\NormalTok{, vmax}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{ax.axis(}\StringTok{\textquotesingle{}off\textquotesingle{}}\NormalTok{)}
\NormalTok{ax.set\_title(}\StringTok{\textquotesingle{}Original Image\textquotesingle{}}\NormalTok{, fontsize}\OperatorTok{=}\DecValTok{14}\NormalTok{, fontweight}\OperatorTok{=}\StringTok{\textquotesingle{}bold\textquotesingle{}}\NormalTok{, pad}\OperatorTok{=}\DecValTok{10}\NormalTok{)}
\NormalTok{plt.tight\_layout()}
\NormalTok{plt.show()}

\BuiltInTok{print}\NormalTok{(}\SpecialStringTok{f"Image shape: }\SpecialCharTok{\{}\NormalTok{img\_array}\SpecialCharTok{.}\NormalTok{shape}\SpecialCharTok{\}}\SpecialStringTok{"}\NormalTok{)}
\BuiltInTok{print}\NormalTok{(}\SpecialStringTok{f"Image size: }\SpecialCharTok{\{}\NormalTok{img\_array}\SpecialCharTok{.}\NormalTok{shape[}\DecValTok{0}\NormalTok{]}\SpecialCharTok{\}}\SpecialStringTok{x}\SpecialCharTok{\{}\NormalTok{img\_array}\SpecialCharTok{.}\NormalTok{shape[}\DecValTok{1}\NormalTok{]}\SpecialCharTok{\}}\SpecialStringTok{ pixels"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \pandocbounded{\includegraphics[keepaspectratio]{index_files/figure-pdf/load-image-output-1.pdf}}

}

\caption{Original image before stippling}

\end{figure}%

\begin{verbatim}
Image shape: (4215, 4284)
Image size: 4215x4284 pixels
\end{verbatim}

Make sure the headshot you want to stipple is saved in the project
directory as \texttt{sam\_headshot.jpg} (keep the \texttt{.jpg}
extension, or adjust \texttt{img\_path} to whatever filename you
choose).

\subsection{Importance Mapping}\label{importance-mapping}

Before applying the stippling algorithm, we create an \textbf{importance
map} that identifies which regions of the image should receive more
stipples. The importance map is computed by:

\begin{itemize}
\tightlist
\item
  \textbf{Brightness inversion}: The image brightness is inverted so
  that dark areas receive higher importance and thus more dots, while
  light areas receive fewer dots
\item
  \textbf{Extreme tone downweighting}: Smooth Gaussian functions
  downweight tones below 0.2 (very dark) and above 0.8 (very light),
  creating a gradual transition that preserves mid-tones
\item
  \textbf{Mid-tone boost}: A smooth Gaussian function centered on
  mid-tones provides a gradual increase in importance for mid-tone
  regions, ensuring they receive appropriate stippling density
\item
  \textbf{Selective and effective}: This approach ensures that stipples
  are distributed appropriately (more dots in dark areas and mid-tones,
  fewer in extreme dark/light areas) while maintaining good spatial
  distribution
\end{itemize}

\subsubsection{Python}

\phantomsection\label{importance-map}
\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ compute\_importance(}
\NormalTok{    gray\_img: np.ndarray,}
\NormalTok{    extreme\_downweight: }\BuiltInTok{float} \OperatorTok{=} \FloatTok{0.5}\NormalTok{,}
\NormalTok{    extreme\_threshold\_low: }\BuiltInTok{float} \OperatorTok{=} \FloatTok{0.4}\NormalTok{,}
\NormalTok{    extreme\_threshold\_high: }\BuiltInTok{float} \OperatorTok{=} \FloatTok{0.8}\NormalTok{,}
\NormalTok{    extreme\_sigma: }\BuiltInTok{float} \OperatorTok{=} \FloatTok{0.1}\NormalTok{,}
\NormalTok{    mid\_tone\_boost: }\BuiltInTok{float} \OperatorTok{=} \FloatTok{0.4}\NormalTok{,}
\NormalTok{    mid\_tone\_sigma: }\BuiltInTok{float} \OperatorTok{=} \FloatTok{0.2}\NormalTok{,}
\NormalTok{):}
    \CommentTok{"""}
\CommentTok{    Importance map computation that downweights extreme tones (very dark and very light)}
\CommentTok{    using smooth functions, while boosting mid{-}tones.}
\CommentTok{    }
\CommentTok{    Parameters}
\CommentTok{    {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{    gray\_img : np.ndarray}
\CommentTok{        Grayscale image in [0, 1]}
\CommentTok{    extreme\_downweight : float}
\CommentTok{        Strength of downweighting for extreme tones (0.0 = no downweighting, 1.0 = maximum downweighting)}
\CommentTok{    extreme\_threshold\_low : float}
\CommentTok{        Threshold below which tones are considered "very dark" and get downweighted}
\CommentTok{    extreme\_threshold\_high : float}
\CommentTok{        Threshold above which tones are considered "very light" and get downweighted}
\CommentTok{    extreme\_sigma : float}
\CommentTok{        Width of the smooth transition for extreme downweighting (smaller = sharper transition)}
\CommentTok{    mid\_tone\_boost : float}
\CommentTok{        Strength of mid{-}tone emphasis (0.0 = no boost, 1.0 = strong boost)}
\CommentTok{    mid\_tone\_sigma : float}
\CommentTok{        Width of the mid{-}tone Gaussian bump (smaller = narrower, larger = wider)}
\CommentTok{    }
\CommentTok{    Returns}
\CommentTok{    {-}{-}{-}{-}{-}{-}{-}}
\CommentTok{    importance : np.ndarray}
\CommentTok{        Importance map in [0, 1]; higher = more stipples (dark areas and mid{-}tones get higher importance)}
\CommentTok{    """}
\NormalTok{    I }\OperatorTok{=}\NormalTok{ np.clip(gray\_img, }\FloatTok{0.0}\NormalTok{, }\FloatTok{1.0}\NormalTok{)}
    
    \CommentTok{\# Invert brightness: dark areas should get more dots (higher importance)}
\NormalTok{    I\_inverted }\OperatorTok{=} \FloatTok{1.0} \OperatorTok{{-}}\NormalTok{ I}
    
    \CommentTok{\# Create smooth downweighting mask for extreme tones}
    \CommentTok{\# Downweight very dark regions (I \textless{} extreme\_threshold\_low)}
\NormalTok{    dark\_mask }\OperatorTok{=}\NormalTok{ np.exp(}\OperatorTok{{-}}\NormalTok{((I }\OperatorTok{{-}} \FloatTok{0.0}\NormalTok{) }\OperatorTok{**} \DecValTok{2}\NormalTok{) }\OperatorTok{/}\NormalTok{ (}\FloatTok{2.0} \OperatorTok{*}\NormalTok{ (extreme\_sigma }\OperatorTok{**} \DecValTok{2}\NormalTok{)))}
\NormalTok{    dark\_mask }\OperatorTok{=}\NormalTok{ np.where(I }\OperatorTok{\textless{}}\NormalTok{ extreme\_threshold\_low, dark\_mask, }\FloatTok{0.0}\NormalTok{)}
    \ControlFlowTok{if}\NormalTok{ dark\_mask.}\BuiltInTok{max}\NormalTok{() }\OperatorTok{\textgreater{}} \DecValTok{0}\NormalTok{:}
\NormalTok{        dark\_mask }\OperatorTok{=}\NormalTok{ dark\_mask }\OperatorTok{/}\NormalTok{ dark\_mask.}\BuiltInTok{max}\NormalTok{()}
    
    \CommentTok{\# Downweight very light regions (I \textgreater{} extreme\_threshold\_high)}
\NormalTok{    light\_mask }\OperatorTok{=}\NormalTok{ np.exp(}\OperatorTok{{-}}\NormalTok{((I }\OperatorTok{{-}} \FloatTok{1.0}\NormalTok{) }\OperatorTok{**} \DecValTok{2}\NormalTok{) }\OperatorTok{/}\NormalTok{ (}\FloatTok{2.0} \OperatorTok{*}\NormalTok{ (extreme\_sigma }\OperatorTok{**} \DecValTok{2}\NormalTok{)))}
\NormalTok{    light\_mask }\OperatorTok{=}\NormalTok{ np.where(I }\OperatorTok{\textgreater{}}\NormalTok{ extreme\_threshold\_high, light\_mask, }\FloatTok{0.0}\NormalTok{)}
    \ControlFlowTok{if}\NormalTok{ light\_mask.}\BuiltInTok{max}\NormalTok{() }\OperatorTok{\textgreater{}} \DecValTok{0}\NormalTok{:}
\NormalTok{        light\_mask }\OperatorTok{=}\NormalTok{ light\_mask }\OperatorTok{/}\NormalTok{ light\_mask.}\BuiltInTok{max}\NormalTok{()}
    
    \CommentTok{\# Combine both masks}
\NormalTok{    extreme\_mask }\OperatorTok{=}\NormalTok{ np.maximum(dark\_mask, light\_mask)}
    
    \CommentTok{\# Apply smooth downweighting}
\NormalTok{    importance }\OperatorTok{=}\NormalTok{ I\_inverted }\OperatorTok{*}\NormalTok{ (}\FloatTok{1.0} \OperatorTok{{-}}\NormalTok{ extreme\_downweight }\OperatorTok{*}\NormalTok{ extreme\_mask)}
    
    \CommentTok{\# Add smooth gradual mid{-}tone boost (Gaussian centered on 0.65)}
\NormalTok{    mid\_tone\_center }\OperatorTok{=} \FloatTok{0.65}
\NormalTok{    mid\_tone\_gaussian }\OperatorTok{=}\NormalTok{ np.exp(}\OperatorTok{{-}}\NormalTok{((I }\OperatorTok{{-}}\NormalTok{ mid\_tone\_center) }\OperatorTok{**} \DecValTok{2}\NormalTok{) }\OperatorTok{/}\NormalTok{ (}\FloatTok{2.0} \OperatorTok{*}\NormalTok{ (mid\_tone\_sigma }\OperatorTok{**} \DecValTok{2}\NormalTok{)))}
    \ControlFlowTok{if}\NormalTok{ mid\_tone\_gaussian.}\BuiltInTok{max}\NormalTok{() }\OperatorTok{\textgreater{}} \DecValTok{0}\NormalTok{:}
\NormalTok{        mid\_tone\_gaussian }\OperatorTok{=}\NormalTok{ mid\_tone\_gaussian }\OperatorTok{/}\NormalTok{ mid\_tone\_gaussian.}\BuiltInTok{max}\NormalTok{()}
    
    \CommentTok{\# Boost importance in mid{-}tone regions}
\NormalTok{    importance }\OperatorTok{=}\NormalTok{ importance }\OperatorTok{*}\NormalTok{ (}\FloatTok{1.0} \OperatorTok{+}\NormalTok{ mid\_tone\_boost }\OperatorTok{*}\NormalTok{ mid\_tone\_gaussian)}
    
    \CommentTok{\# Normalize to [0,1]}
\NormalTok{    m, M }\OperatorTok{=}\NormalTok{ importance.}\BuiltInTok{min}\NormalTok{(), importance.}\BuiltInTok{max}\NormalTok{()}
    \ControlFlowTok{if}\NormalTok{ M }\OperatorTok{\textgreater{}}\NormalTok{ m: }
\NormalTok{        importance }\OperatorTok{=}\NormalTok{ (importance }\OperatorTok{{-}}\NormalTok{ m) }\OperatorTok{/}\NormalTok{ (M }\OperatorTok{{-}}\NormalTok{ m)}
    \ControlFlowTok{return}\NormalTok{ importance}
\end{Highlighting}
\end{Shaded}

\subsection{Blue Noise Stippling
Algorithm}\label{blue-noise-stippling-algorithm}

The stippling algorithm uses a modified void-and-cluster approach that:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Creates an importance map that identifies visually important regions
\item
  Initializes an energy field based on the importance map (higher
  importance â†’ lower energy)
\item
  Uses a toroidal (periodic) Gaussian kernel for repulsion to ensure
  blue noise properties
\item
  Iteratively selects points with minimum energy
\item
  Adds Gaussian ``splats'' around selected points to prevent clustering
\item
  Balances image content importance with blue noise spatial distribution
\end{enumerate}

\subsubsection{Python}

\phantomsection\label{stippling-functions}
\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ numpy }\ImportTok{as}\NormalTok{ np}

\KeywordTok{def}\NormalTok{ toroidal\_gaussian\_kernel(h: }\BuiltInTok{int}\NormalTok{, w: }\BuiltInTok{int}\NormalTok{, sigma: }\BuiltInTok{float}\NormalTok{):}
    \CommentTok{"""}
\CommentTok{    Create a periodic (toroidal) 2D Gaussian kernel centered at (0,0).}
\CommentTok{    The toroidal property means the kernel wraps around at the edges,}
\CommentTok{    ensuring consistent repulsion behavior regardless of point location.}
\CommentTok{    """}
\NormalTok{    y }\OperatorTok{=}\NormalTok{ np.arange(h)}
\NormalTok{    x }\OperatorTok{=}\NormalTok{ np.arange(w)}
    \CommentTok{\# Compute toroidal distances (minimum distance considering wrapping)}
\NormalTok{    dy }\OperatorTok{=}\NormalTok{ np.minimum(y, h }\OperatorTok{{-}}\NormalTok{ y)[:, }\VariableTok{None}\NormalTok{]}
\NormalTok{    dx }\OperatorTok{=}\NormalTok{ np.minimum(x, w }\OperatorTok{{-}}\NormalTok{ x)[}\VariableTok{None}\NormalTok{, :]}
    \CommentTok{\# Compute Gaussian}
\NormalTok{    kern }\OperatorTok{=}\NormalTok{ np.exp(}\OperatorTok{{-}}\NormalTok{(dx}\OperatorTok{**}\DecValTok{2} \OperatorTok{+}\NormalTok{ dy}\OperatorTok{**}\DecValTok{2}\NormalTok{) }\OperatorTok{/}\NormalTok{ (}\FloatTok{2.0} \OperatorTok{*}\NormalTok{ sigma}\OperatorTok{**}\DecValTok{2}\NormalTok{))}
\NormalTok{    s }\OperatorTok{=}\NormalTok{ kern.}\BuiltInTok{sum}\NormalTok{()}
    \ControlFlowTok{if}\NormalTok{ s }\OperatorTok{\textgreater{}} \DecValTok{0}\NormalTok{:}
\NormalTok{        kern }\OperatorTok{/=}\NormalTok{ s  }\CommentTok{\# Normalize}
    \ControlFlowTok{return}\NormalTok{ kern}


\KeywordTok{def}\NormalTok{ void\_and\_cluster(}
\NormalTok{    input\_img: np.ndarray,}
\NormalTok{    percentage: }\BuiltInTok{float} \OperatorTok{=} \FloatTok{0.08}\NormalTok{,}
\NormalTok{    sigma: }\BuiltInTok{float} \OperatorTok{=} \FloatTok{0.9}\NormalTok{,}
\NormalTok{    content\_bias: }\BuiltInTok{float} \OperatorTok{=} \FloatTok{0.9}\NormalTok{,}
\NormalTok{    importance\_img: np.ndarray }\OperatorTok{|} \VariableTok{None} \OperatorTok{=} \VariableTok{None}\NormalTok{,}
\NormalTok{    noise\_scale\_factor: }\BuiltInTok{float} \OperatorTok{=} \FloatTok{0.1}\NormalTok{,}
\NormalTok{):}
    \CommentTok{"""}
\CommentTok{    Generate blue noise stippling pattern from input image using a modified}
\CommentTok{    void{-}and{-}cluster algorithm with content{-}weighted importance.}
\CommentTok{    """}
\NormalTok{    I }\OperatorTok{=}\NormalTok{ np.clip(input\_img, }\FloatTok{0.0}\NormalTok{, }\FloatTok{1.0}\NormalTok{)}
\NormalTok{    h, w }\OperatorTok{=}\NormalTok{ I.shape}

    \CommentTok{\# Compute or use provided importance map}
    \ControlFlowTok{if}\NormalTok{ importance\_img }\KeywordTok{is} \VariableTok{None}\NormalTok{:}
\NormalTok{        importance }\OperatorTok{=}\NormalTok{ compute\_importance(I)}
    \ControlFlowTok{else}\NormalTok{:}
\NormalTok{        importance }\OperatorTok{=}\NormalTok{ np.clip(importance\_img, }\FloatTok{0.0}\NormalTok{, }\FloatTok{1.0}\NormalTok{)}

    \CommentTok{\# Create toroidal Gaussian kernel for repulsion}
\NormalTok{    kernel }\OperatorTok{=}\NormalTok{ toroidal\_gaussian\_kernel(h, w, sigma)}

    \CommentTok{\# Initialize energy field: lower energy â†’ more likely to be picked}
\NormalTok{    energy\_current }\OperatorTok{=} \OperatorTok{{-}}\NormalTok{importance }\OperatorTok{*}\NormalTok{ content\_bias}

    \CommentTok{\# Stipple buffer: start with white background; selected points become black dots}
\NormalTok{    final\_stipple }\OperatorTok{=}\NormalTok{ np.ones\_like(I)}
\NormalTok{    samples }\OperatorTok{=}\NormalTok{ []}

    \CommentTok{\# Helper function to roll kernel to an arbitrary position}
    \KeywordTok{def}\NormalTok{ energy\_splat(y, x):}
        \CommentTok{"""Get energy contribution by rolling the kernel to position (y, x)."""}
        \ControlFlowTok{return}\NormalTok{ np.roll(np.roll(kernel, shift}\OperatorTok{=}\NormalTok{y, axis}\OperatorTok{=}\DecValTok{0}\NormalTok{), shift}\OperatorTok{=}\NormalTok{x, axis}\OperatorTok{=}\DecValTok{1}\NormalTok{)}

    \CommentTok{\# Number of points to select}
\NormalTok{    num\_points }\OperatorTok{=} \BuiltInTok{int}\NormalTok{(I.size }\OperatorTok{*}\NormalTok{ percentage)}

    \CommentTok{\# Choose first point near center with minimal energy}
\NormalTok{    cy, cx }\OperatorTok{=}\NormalTok{ h }\OperatorTok{//} \DecValTok{2}\NormalTok{, w }\OperatorTok{//} \DecValTok{2}
\NormalTok{    r }\OperatorTok{=} \BuiltInTok{min}\NormalTok{(}\DecValTok{20}\NormalTok{, h }\OperatorTok{//} \DecValTok{10}\NormalTok{, w }\OperatorTok{//} \DecValTok{10}\NormalTok{)}
\NormalTok{    ys }\OperatorTok{=} \BuiltInTok{slice}\NormalTok{(}\BuiltInTok{max}\NormalTok{(}\DecValTok{0}\NormalTok{, cy }\OperatorTok{{-}}\NormalTok{ r), }\BuiltInTok{min}\NormalTok{(h, cy }\OperatorTok{+}\NormalTok{ r))}
\NormalTok{    xs }\OperatorTok{=} \BuiltInTok{slice}\NormalTok{(}\BuiltInTok{max}\NormalTok{(}\DecValTok{0}\NormalTok{, cx }\OperatorTok{{-}}\NormalTok{ r), }\BuiltInTok{min}\NormalTok{(w, cx }\OperatorTok{+}\NormalTok{ r))}
\NormalTok{    region }\OperatorTok{=}\NormalTok{ energy\_current[ys, xs]}
\NormalTok{    flat }\OperatorTok{=}\NormalTok{ np.argmin(region)}
\NormalTok{    y0 }\OperatorTok{=}\NormalTok{ flat }\OperatorTok{//}\NormalTok{ (region.shape[}\DecValTok{1}\NormalTok{]) }\OperatorTok{+}\NormalTok{ (cy }\OperatorTok{{-}}\NormalTok{ r)}
\NormalTok{    x0 }\OperatorTok{=}\NormalTok{ flat }\OperatorTok{\%}\NormalTok{ (region.shape[}\DecValTok{1}\NormalTok{]) }\OperatorTok{+}\NormalTok{ (cx }\OperatorTok{{-}}\NormalTok{ r)}

    \CommentTok{\# Place first point}
\NormalTok{    energy\_current }\OperatorTok{=}\NormalTok{ energy\_current }\OperatorTok{+}\NormalTok{ energy\_splat(y0, x0)}
\NormalTok{    energy\_current[y0, x0] }\OperatorTok{=}\NormalTok{ np.inf  }\CommentTok{\# Prevent reselection}
\NormalTok{    samples.append((y0, x0, I[y0, x0]))}
\NormalTok{    final\_stipple[y0, x0] }\OperatorTok{=} \FloatTok{0.0}  \CommentTok{\# Black dot}

    \CommentTok{\# Iteratively place remaining points}
    \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\DecValTok{1}\NormalTok{, num\_points):}
        \CommentTok{\# Add exploration noise that decreases over time}
\NormalTok{        exploration }\OperatorTok{=} \FloatTok{1.0} \OperatorTok{{-}}\NormalTok{ (i }\OperatorTok{/}\NormalTok{ num\_points) }\OperatorTok{*} \FloatTok{0.5}  \CommentTok{\# Decrease from 1.0 to 0.5}
\NormalTok{        noise }\OperatorTok{=}\NormalTok{ np.random.normal(}\FloatTok{0.0}\NormalTok{, noise\_scale\_factor }\OperatorTok{*}\NormalTok{ content\_bias }\OperatorTok{*}\NormalTok{ exploration, size}\OperatorTok{=}\NormalTok{energy\_current.shape)}
\NormalTok{        energy\_with\_noise }\OperatorTok{=}\NormalTok{ energy\_current }\OperatorTok{+}\NormalTok{ noise}

        \CommentTok{\# Find position with minimum energy (with noise for exploration)}
\NormalTok{        pos\_flat }\OperatorTok{=}\NormalTok{ np.argmin(energy\_with\_noise)}
\NormalTok{        y }\OperatorTok{=}\NormalTok{ pos\_flat }\OperatorTok{//}\NormalTok{ w}
\NormalTok{        x }\OperatorTok{=}\NormalTok{ pos\_flat }\OperatorTok{\%}\NormalTok{ w}

        \CommentTok{\# Add Gaussian splat to prevent nearby points from being selected}
\NormalTok{        energy\_current }\OperatorTok{=}\NormalTok{ energy\_current }\OperatorTok{+}\NormalTok{ energy\_splat(y, x)}
\NormalTok{        energy\_current[y, x] }\OperatorTok{=}\NormalTok{ np.inf  }\CommentTok{\# Prevent reselection}

        \CommentTok{\# Record the sample}
\NormalTok{        samples.append((y, x, I[y, x]))}
\NormalTok{        final\_stipple[y, x] }\OperatorTok{=} \FloatTok{0.0}  \CommentTok{\# Black dot}

    \ControlFlowTok{return}\NormalTok{ final\_stipple, np.array(samples)}
\end{Highlighting}
\end{Shaded}

\subsection{Preparing the Working
Image}\label{preparing-the-working-image}

Before generating the stippling pattern, we prepare the image by
resizing if necessary and computing the importance map.

\subsubsection{Python}

\phantomsection\label{prep-image}
\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Resize image if it\textquotesingle{}s too large for faster processing}
\NormalTok{max\_size }\OperatorTok{=} \DecValTok{512}
\ControlFlowTok{if}\NormalTok{ img\_array.shape[}\DecValTok{0}\NormalTok{] }\OperatorTok{\textgreater{}}\NormalTok{ max\_size }\KeywordTok{or}\NormalTok{ img\_array.shape[}\DecValTok{1}\NormalTok{] }\OperatorTok{\textgreater{}}\NormalTok{ max\_size:}
\NormalTok{    scale }\OperatorTok{=}\NormalTok{ max\_size }\OperatorTok{/} \BuiltInTok{max}\NormalTok{(img\_array.shape[}\DecValTok{0}\NormalTok{], img\_array.shape[}\DecValTok{1}\NormalTok{])}
\NormalTok{    new\_size }\OperatorTok{=}\NormalTok{ (}\BuiltInTok{int}\NormalTok{(img\_array.shape[}\DecValTok{1}\NormalTok{] }\OperatorTok{*}\NormalTok{ scale), }\BuiltInTok{int}\NormalTok{(img\_array.shape[}\DecValTok{0}\NormalTok{] }\OperatorTok{*}\NormalTok{ scale))}
\NormalTok{    img\_resized\_pil }\OperatorTok{=}\NormalTok{ original\_img.resize(new\_size, Image.Resampling.LANCZOS)}
    \ControlFlowTok{if}\NormalTok{ img\_resized\_pil.mode }\OperatorTok{!=} \StringTok{\textquotesingle{}L\textquotesingle{}}\NormalTok{:}
\NormalTok{        img\_resized\_pil }\OperatorTok{=}\NormalTok{ img\_resized\_pil.convert(}\StringTok{\textquotesingle{}L\textquotesingle{}}\NormalTok{)}
\NormalTok{    img\_resized }\OperatorTok{=}\NormalTok{ np.array(img\_resized\_pil, dtype}\OperatorTok{=}\NormalTok{np.float32) }\OperatorTok{/} \FloatTok{255.0}
    \BuiltInTok{print}\NormalTok{(}\SpecialStringTok{f"Resized image from }\SpecialCharTok{\{}\NormalTok{img\_array}\SpecialCharTok{.}\NormalTok{shape}\SpecialCharTok{\}}\SpecialStringTok{ to }\SpecialCharTok{\{}\NormalTok{img\_resized}\SpecialCharTok{.}\NormalTok{shape}\SpecialCharTok{\}}\SpecialStringTok{ for processing"}\NormalTok{)}
\ControlFlowTok{else}\NormalTok{:}
\NormalTok{    img\_resized }\OperatorTok{=}\NormalTok{ img\_array.copy()}

\CommentTok{\# Ensure img\_resized is 2D grayscale}
\ControlFlowTok{if} \BuiltInTok{len}\NormalTok{(img\_resized.shape) }\OperatorTok{\textgreater{}} \DecValTok{2}\NormalTok{:}
\NormalTok{    img\_resized }\OperatorTok{=}\NormalTok{ img\_resized[:, :, }\DecValTok{0}\NormalTok{]}
\ControlFlowTok{elif} \BuiltInTok{len}\NormalTok{(img\_resized.shape) }\OperatorTok{==} \DecValTok{2}\NormalTok{:}
    \ControlFlowTok{pass}
\ControlFlowTok{else}\NormalTok{:}
    \ControlFlowTok{raise} \PreprocessorTok{ValueError}\NormalTok{(}\SpecialStringTok{f"Unexpected image shape: }\SpecialCharTok{\{}\NormalTok{img\_resized}\SpecialCharTok{.}\NormalTok{shape}\SpecialCharTok{\}}\SpecialStringTok{"}\NormalTok{)}

\BuiltInTok{print}\NormalTok{(}\SpecialStringTok{f"Final image shape: }\SpecialCharTok{\{}\NormalTok{img\_resized}\SpecialCharTok{.}\NormalTok{shape}\SpecialCharTok{\}}\SpecialStringTok{ (should be 2D for grayscale)"}\NormalTok{)}

\CommentTok{\# Compute importance map using default parameters}
\NormalTok{importance\_map }\OperatorTok{=}\NormalTok{ compute\_importance(}
\NormalTok{    img\_resized,}
\NormalTok{    extreme\_downweight}\OperatorTok{=}\FloatTok{0.5}\NormalTok{,}
\NormalTok{    extreme\_threshold\_low}\OperatorTok{=}\FloatTok{0.2}\NormalTok{,}
\NormalTok{    extreme\_threshold\_high}\OperatorTok{=}\FloatTok{0.8}\NormalTok{,}
\NormalTok{    extreme\_sigma}\OperatorTok{=}\FloatTok{0.1}
\NormalTok{)}
\BuiltInTok{print}\NormalTok{(}\StringTok{"Importance map computed"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Resized image from (4215, 4284) to (503, 512) for processing
Final image shape: (503, 512) (should be 2D for grayscale)
Importance map computed
\end{verbatim}




\end{document}
